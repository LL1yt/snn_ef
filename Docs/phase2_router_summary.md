# –§–∞–∑–∞ 2: EnergeticRouter Core v1 (CPU) - –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

## üìã –û–±–∑–æ—Ä

**–¶–µ–ª—å**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —è–¥—Ä–æ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞ –Ω–∞ CPU —Å forward/backward pass, loss-—Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏.

**–û–±—â–µ–µ –≤—Ä–µ–º—è**: ~10-14 —á–∞—Å–æ–≤
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è ML-–∏–Ω–∂–µ–Ω–µ—Ä–∏—è)

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1Ô∏è‚É£ –°—Ç—Ä—É–∫—Ç—É—Ä—ã –≥—Ä–∞—Ñ–∞ (¬ß 2.1)
- **GraphTypes.swift**: NodeID, Edge, LayerConfig, GraphConfig
- **Graph.swift**: CSR-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (rowPtr, colIdx, weights)
- **GraphBuilder.swift**: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–µ—à—ë—Ç–∫–∏ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ + jump —Å–æ—Å–µ–¥—è–º–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ì—Ä–∞—Ñ 10√ó1024 —É–∑–ª–æ–≤ –∏–∑ `baseline.yaml`

### 2Ô∏è‚É£ Forward-pass CPU (¬ß 2.2)
- **RouterParams.swift**: Q, K, bias, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (Xavier)
- **ForwardPassCPU.swift**:
  - –õ–æ–≥–∏—Ç—ã: `dot(Q[j], K[k]) + bias`
  - Softmax —Å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π œÑ
  - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏: `Œ±¬∑e¬∑œÄ_jk`
  - Top-K –æ—Ç–±–æ—Ä
- **Metrics.swift**: –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ (—ç–Ω–µ—Ä–≥–∏—è, —ç–Ω—Ç—Ä–æ–ø–∏—è, –∞–∫—Ç–∏–≤–Ω—ã–µ —É–∑–ª—ã)

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –†–∞–±–æ—Ç–∞—é—â–∏–π forward-pass —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —ç–Ω–µ—Ä–≥–∏–∏

### 3Ô∏è‚É£ Loss & Backprop (¬ß 2.3)
- **Loss.swift**: MSELoss, CrossEntropyLoss, EntropyRegularization
- **BackwardPassCPU.swift**: –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã –ø–æ Q, K, bias (softmax backward)
- **Optimizer.swift**: Adam —Å –º–æ–º–µ–Ω—Ç–∞–º–∏ m, v

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã (—á–∏—Å–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)

### 4Ô∏è‚É£ Logging & Metrics (¬ß 2.4)
- **RouterLogger.swift**: –°–æ–±—ã—Ç–∏—è `router.forward`, `router.backward`
- **PipelineSnapshot**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ–ª—è–º–∏ —Ä–æ—É—Ç–µ—Ä–∞
- **MetricsExporter.swift**: –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV/JSON

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏

---

## üìä –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```
–≠—Ç–∞–ø 1: –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (¬ß 2.1)    ‚Üí  2-3 —á–∞—Å–∞
   ‚Üì
–≠—Ç–∞–ø 2: Forward-pass (¬ß 2.2)         ‚Üí  3-4 —á–∞—Å–∞
   ‚Üì
–≠—Ç–∞–ø 3: Loss & Backprop (¬ß 2.3)      ‚Üí  3-4 —á–∞—Å–∞
   ‚Üì
–≠—Ç–∞–ø 4: Logging & Integration (¬ß 2.4) ‚Üí  2-3 —á–∞—Å–∞
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ –ì—Ä–∞—Ñ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- ‚úÖ Forward-pass —Ä–∞–±–æ—Ç–∞–µ—Ç (Accelerate/vDSP)
- ‚úÖ Backward-pass –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- ‚úÖ Adam –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- ‚úÖ `swift test --filter EnergeticCoreTests` –ø—Ä–æ—Ö–æ–¥–∏—Ç
- ‚úÖ –ß–∏—Å–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ (finite differences)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏: `sum(output) ‚âà Œ±¬∑sum(input)`
- ‚úÖ Softmax: `sum(œÄ_jk) ‚âà 1.0`

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- ‚úÖ –°–æ–±—ã—Ç–∏—è –≤ LoggingHub
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –≤ MetricsCollector
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV/JSON

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Accelerate:
- `vDSP_dotpr` - dot products –¥–ª—è –ª–æ–≥–∏—Ç–æ–≤
- `vDSP_vsmul` - –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏
- Custom softmax —Å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π

### CSR-—Ñ–æ—Ä–º–∞—Ç –≥—Ä–∞—Ñ–∞:
```
rowPtr[j] ‚Üí rowPtr[j+1]  = –¥–∏–∞–ø–∞–∑–æ–Ω —Ä—ë–±–µ—Ä —É–∑–ª–∞ j
colIdx[i]                 = –∏–Ω–¥–µ–∫—Å —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞ –¥–ª—è —Ä–µ–±—Ä–∞ i
weights[i]                = –≤–µ—Å —Ä–µ–±—Ä–∞ i
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–∏–∑ baseline.yaml):
```yaml
router:
  layers: 10
  nodes_per_layer: 1024
  neighbors:
    local: 8    # —Å–æ—Å–µ–¥–∏ –≤ —Å–ª–æ–µ j+1
    jump: 2     # —Å–æ—Å–µ–¥–∏ –≤ —Å–ª–æ–µ j+2
  alpha: 0.9    # –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏
  tau: 3.0      # —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ softmax
  top_k: 4      # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ä—ë–±–µ—Ä
```

---

## üöÄ –ü–æ—Å–ª–µ —Ñ–∞–∑—ã 2

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫:
- **¬ß 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Capsule ‚Üî Router**: CapsuleBridge
- **¬ß 4. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ EnergeticUI
- **¬ß 5. –ö–∞—á–µ—Å—Ç–≤–æ**: –ë–µ–Ω—á–º–∞—Ä–∫–∏, –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω**: `Docs/phase2_router_implementation_plan.md`
- **–û–±—â–∏–π –ø–ª–∞–Ω —Ñ–∞–∑—ã 2**: `Docs/phase2_execution_plan.md`
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–æ—É—Ç–µ—Ä–∞**: `Docs/plan_snn_router_swift_macos.md`
- **–°—Ö–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥–∞**: `Docs/config_center_schema.md`

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–ª–∞–Ω –≥–æ—Ç–æ–≤, –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é!
