# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã ¬´—ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ—É—Ç–µ—Ä¬ª (macOS ¬∑ Swift ¬∑ M4 ¬∑ CPU/GPU ¬∑ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è/CLI)

_–° –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –¥–æ–ª–µ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ ‚âà 85 %: —Å–ª–µ–¥—É—é—â–∏–π –ø–ª–∞–Ω –ø–æ–∑–≤–æ–ª–∏—Ç –±—ã—Å—Ç—Ä–æ —Å–æ–±—Ä–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø (MVP), —É–¥–µ—Ä–∂–∏–≤–∞—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π. –¢–æ–Ω –¥–µ—Ä–∂–∏–º –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ‚Äë—Å–∫–µ–ø—Ç–∏—á–µ—Å–∫–∏–π: –∫–∞–∂–¥–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ–º —Ç–µ—Å—Ç–∞–º–∏ –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏._

---

## –¶–µ–ª–∏
- **MVP**: —Å–æ–±—ã—Ç–∏–π–Ω–æ‚Äë–ø–æ—Ç–æ—á–Ω–∞—è —Å–µ—Ç—å (–±–µ–∑ –¥–∏—Å–∫—Ä–µ—Ç–Ω—ã—Ö —Å–ø–∞–π–∫–æ–≤), –≥–¥–µ —É–∑–ª—ã‚Äë¬´–∫–ª–∞–ø–∞–Ω—ã¬ª –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É—é—Ç ¬´—ç–Ω–µ—Ä–≥–∏—é¬ª –ø–æ –≥—Ä–∞—Ñ—É —Å–ª–æ—ë–≤; –æ–±—É—á–µ–Ω–∏–µ ‚Äî —Å–Ω–∞—á–∞–ª–∞ –æ–±—ã—á–Ω—ã–π backprop –ø–æ –º—è–≥–∫–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏, –∑–∞—Ç–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (reward‚Äëmodulated Hebb).
- **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞**: macOS (Apple Silicon, M4), Swift 5.10+, Swift Concurrency, Metal (GPU), Accelerate/BNNS (CPU).
- **–†–µ–∂–∏–º—ã**: `--headless` (CLI –±–µ–∑ UI) –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è **–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è** (SwiftUI/MetalKit).
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –Ω–∞ CPU, GPU‚Äë—è–¥—Ä–∞ –¥–ª—è ¬´—Ç—è–∂—ë–ª—ã—Ö¬ª —É—á–∞—Å—Ç–∫–æ–≤, –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Instruments.
- **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å**: –∫–æ–Ω—Ñ–∏–≥–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–∏–¥—ã, —Å–Ω–∞–ø—à–æ—Ç—ã –≤–µ—Å–æ–≤, –º–µ—Ç—Ä–∏–∫–∏ –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã.

---

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- **–ì—Ä–∞—Ñ**: 10 —Å–ª–æ—ë–≤ √ó N —É–∑–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1024), —É –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –∏—Å—Ö–æ–¥—è—â–∏—Ö —Ä—ë–±–µ—Ä `ùí©(j)` (8 –ª–æ–∫–∞–ª—å–Ω—ã—Ö + –¥–æ 2 ¬´–ø—Ä—ã–∂–∫–æ–≤¬ª —á–µ—Ä–µ–∑ —Å–ª–æ–π).
- **–£–∑–µ–ª (¬´–≤–µ–Ω—Ç–∏–ª—å‚Äë–¥–µ–ª–∏—Ç–µ–ª—å‚Äë—Ä–æ—É—Ç–µ—Ä¬ª)**: –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é `e‚àà[0,Emax]` –∏ –ø–æ–∑–∏—Ü–∏—é, –≤—ã—á–∏—Å–ª—è–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –ø–æ –∏—Å—Ö–æ–¥—è—â–∏–º —Ä—ë–±—Ä–∞–º `œÄ_{jk}` —á–µ—Ä–µ–∑ –º—è–≥–∫–∏–π –≤—ã–±–æ—Ä (softmax/—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ œÑ), –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —ç–Ω–µ—Ä–≥–∏—é `Œ±¬∑e¬∑œÄ_{jk}` –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≤—ã—Ö–æ–¥—ã (top‚ÄëK –∏–ª–∏ –ø–æ–ª–Ω–æ–µ).
- **–û–±—É—á–µ–Ω–∏–µ v1 (–±—ç–π–∑–ª–∞–π–Ω)**: –º—è–≥–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è + —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–æ—Ç–µ—Ä—è (MSE/CE) + —ç–Ω—Ç—Ä–æ–ø–∏–π–Ω–∞—è —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è; –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä Adam.
- **–û–±—É—á–µ–Ω–∏–µ v2 (–ª–æ–∫–∞–ª—å–Ω–æ–µ)**: reward‚Äëmodulated Hebbian (—Å–ª–µ–¥ –≤–æ—Å–ø—Ä–∏–∏–º—á–∏–≤–æ—Å—Ç–∏ E_{jk} + –Ω–∞–≥—Ä–∞–¥–∞ r) –¥–ª—è –≤–µ—Å–æ–≤ —Ä—ë–±–µ—Ä; —Ä–æ—É—Ç–µ—Ä ‚Äî —á–µ—Ä–µ–∑ REINFORCE‚Äë–ø–æ–¥–æ–±–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å backprop.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –Ω–æ—Ä–º–∏—Ä–æ–≤–∫–∞ –∏—Å—Ö–æ–¥—è—â–∏—Ö –≤–µ—Å–æ–≤, –∫–æ–Ω—Ç—Ä–æ–ª—å —Å—É–º–º–∞—Ä–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏, homeostasis –¥–ª—è –ø–æ—Ä–æ–≥–æ–≤/—á–∞—Å—Ç–æ—Ç—ã –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```
EnergeticRouter/
‚îú‚îÄ Sources/
‚îÇ  ‚îú‚îÄ Infrastructure/
‚îÇ  ‚îÇ  ‚îú‚îÄ ConfigCenter.swift   # –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤ (–∫–∞–ø—Å—é–ª—å + —Ä–æ—É—Ç–µ—Ä + UI)
‚îÇ  ‚îÇ  ‚îú‚îÄ LoggingHub.swift     # —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—É—Ä–æ–≤–Ω–∏, process_id)
‚îÇ  ‚îÇ  ‚îú‚îÄ ProcessRegistry.swift# –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞–¥–∏–π –ø–∞–π–ø–ª–∞–π–Ω–∞
‚îÇ  ‚îÇ  ‚îî‚îÄ Diagnostics.swift    # guard'—ã, fail-fast
‚îÇ  ‚îú‚îÄ Core/                 # —è–¥—Ä–æ –º–æ–¥–µ–ª–∏ (–≥—Ä–∞—Ñ, —É–∑–ª—ã, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è)
‚îÇ  ‚îÇ  ‚îú‚îÄ Graph.swift
‚îÇ  ‚îÇ  ‚îú‚îÄ Node.swift
‚îÇ  ‚îÇ  ‚îú‚îÄ Router.swift
‚îÇ  ‚îÇ  ‚îú‚îÄ EnergyKernelsCPU.swift
‚îÇ  ‚îÇ  ‚îú‚îÄ LearningRules.swift
‚îÇ  ‚îÇ  ‚îî‚îÄ Config.swift
‚îÇ  ‚îú‚îÄ GPU/
‚îÇ  ‚îÇ  ‚îú‚îÄ Metal/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ energy_kernels.metal
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ router_kernels.metal
‚îÇ  ‚îÇ  ‚îî‚îÄ MetalBackend.swift
‚îÇ  ‚îú‚îÄ UI/
‚îÇ  ‚îÇ  ‚îú‚îÄ EnergeticApp.swift
‚îÇ  ‚îÇ  ‚îú‚îÄ Views/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ GraphView.swift
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ EnergyFlowView.swift
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ MetricsView.swift
‚îÇ  ‚îú‚îÄ CLI/
‚îÇ  ‚îÇ  ‚îú‚îÄ main.swift         # `swift run energetic --config ... --headless`
‚îÇ  ‚îÇ  ‚îî‚îÄ Args.swift
‚îÇ  ‚îî‚îÄ Utils/
‚îÇ     ‚îú‚îÄ Metrics.swift
‚îÇ     ‚îî‚îÄ Checkpoints.swift
‚îú‚îÄ Tests/
‚îÇ  ‚îú‚îÄ CoreTests.swift
‚îÇ  ‚îú‚îÄ KernelTests.swift
‚îÇ  ‚îî‚îÄ LearningTests.swift
‚îú‚îÄ Configs/
‚îÇ  ‚îú‚îÄ baseline.yaml
‚îÇ  ‚îú‚îÄ local_hebb.yaml
‚îÇ  ‚îî‚îÄ discrete_routing.yaml
‚îú‚îÄ Docs/
‚îÇ  ‚îú‚îÄ README_arch.md        # —Å—Ö–µ–º–∞ –∏ —Å—Å—ã–ª–∫–∏
‚îÇ  ‚îî‚îÄ config_center_schema.md # –µ–¥–∏–Ω–∞—è —Å—Ö–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤ –¥–ª—è Capsule + Router
‚îî‚îÄ Package.swift
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–∞—Ä–∫–∞—Å (–æ–±—â–∏–π —Å ¬´–∫–∞–ø—Å—é–ª–µ–º¬ª)
- **ConfigCenter**: –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º; —Å–Ω–∞–ø—à–æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—Ä–µ—à—ë—Ç–∫–∞, –∫–∞–ø—Å—é–ª—å, UI, –ª–æ–≥–≥–µ—Ä—ã) immutable –≤–Ω—É—Ç—Ä–∏ —à–∞–≥–∞, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ CLI/—Ñ–∞–π–ª—ã.
- **LoggingHub**: —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –∏ JSON-—Ñ–æ—Ä–º–∞—Ç–µ, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É—Ä–æ–≤–Ω–∏ (`trace/debug/info/warn/error`) –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π `process_id` (`capsule`, `router`, `ui`, `cli`, `trainer`, ‚Ä¶).
- **ProcessRegistry**: –≤—ã–¥–∞—ë—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞–¥–∏–π –ø–∞–π–ø–ª–∞–π–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `capsule.encode`, `router.forward`, `router.local_hebb`), —á—Ç–æ–±—ã –ª–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Å—ã–ª–∞–ª–∏—Å—å –Ω–∞ –æ–¥–∏–Ω —Å–ª–æ–≤–∞—Ä—å.
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: SPM-–ø—Ä–æ–¥—É–∫—Ç—ã `EnergeticCore`, `EnergeticUI`, `CapsuleCore`, `SharedInfrastructure`; UI –ø–æ–¥–∫–ª—é—á–∞–µ–º –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, headless-—Ä–µ–∂–∏–º —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –±–µ–∑ SwiftUI –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
- **Fail-fast –ø–æ–ª–∏—Ç–∏–∫–∞**: –ª—é–±—ã–µ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—É—Å—Ç—ã–µ –±–∞—Ç—á–∏, NaN/Inf ‚Üí –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —Å–±–æ–π, –æ—à–∏–±–∫–∏ –ø—É–∑—ã—Ä—è—Ç—Å—è –¥–æ CLI/–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –±–µ–∑ —Å–∫—Ä—ã—Ç—ã—Ö —Ñ–æ–ª–±–µ–∫–æ–≤.

---

## –§–ê–ó–´, –®–ê–ì–ò –ò –ü–û–î–®–ê–ì–ò

### –§–∞–∑–∞ 0. –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–¥–µ–Ω—å 0‚Äì1)
1. **–ü—Ä–æ–µ–∫—Ç**: Swift Package + –∏—Å–ø–æ–ª–Ω—è–µ–º–∞—è —Ü–µ–ª—å (CLI) + App target (SwiftUI).
2. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ —Å—Ç–∞—Ä—Ç–µ; –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ (Accelerate, Metal, SwiftUI).
3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**:
   - `ConfigCenter` —á–∏—Ç–∞–µ—Ç `Configs/*.yaml`, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ —Ä–∞–∑–¥–∞—ë—Ç —Å–Ω–∞–ø—à–æ—Ç –≤—Å–µ–º –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞–º (–∫–∞–ø—Å—é–ª—å, —Ä–æ—É—Ç–µ—Ä, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è).
   - YAML –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä—ã —Ä–µ—à—ë—Ç–∫–∏/–∫–∞–ø—Å—é–ª—è, —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–æ–≤, –≤–∫–ª—é—á–µ–Ω–∏–µ UI; `process_id` –∑–∞–¥–∞—ë—Ç—Å—è —è–≤–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç–∞–¥–∏–∏.
   - –ü–∞—Ä—Å–µ—Ä –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ (Swift ArgumentParser –∏–ª–∏ —Å–≤–æ–π –ø—Ä–æ—Å—Ç–æ–π) –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏ (`--config`, `--ui`/`--headless`).
   - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –∫–ª—é—á–µ–π –∏ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏ –ø–æ `process_id` ‚Üí `Docs/config_center_schema.md`.
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: `LoggingHub` –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç JSON-—Å—Ç—Ä–æ–∫–∏ –∏ —Ç–µ–∫—Å—Ç, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ —É—Ä–æ–≤–Ω–∏, —Ç–µ–≥ `process_id`, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é `os_signpost`.
5. **–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å**: –≥–ª–æ–±–∞–ª—å–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–¥—ã, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `checkpoint-*.bin`.
6. **–û—à–∏–±–∫–∏/–≤–∞–ª–∏–¥–∞—Ü–∏—è**: –±–µ–∑ —Ñ–æ–ª–±–µ–∫–æ–≤; –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏/–¥–∞–Ω–Ω—ã–µ ‚Üí –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π `throw`, –ª–æ–≥–∏—Ä—É–µ–º –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞–π–ø–ª–∞–π–Ω.

_–û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ‚âà 95 % (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ —Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ)._

---

### –§–∞–∑–∞ 1. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è CPU‚Äë—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º—è–≥–∫–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ + backprop (MVP)
1. **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö (Core)**:
   - `struct NodeID { layer: Int; index: Int }`
   - `struct Edge { src: NodeID; dst: NodeID; w: Float }`
   - –°–ø–∏—Å–∫–∏ —Å–æ—Å–µ–¥–µ–π: `Adjacency` –∫–∞–∫ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã (CSR‚Äë–ø–æ–¥–æ–±–Ω–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞ –¥–ª—è –∫—ç—à‚Äë–ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç–∏).
2. **–£–∑–µ–ª/—Ä–æ—É—Ç–µ—Ä**:
   - –ü–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —É–∑–ª–æ–≤ `p_j` (–Ω–∞–ø—Ä–∏–º–µ—Ä, sin/cos –æ—Ç –∏–Ω–¥–µ–∫—Å–∞/—Å–ª–æ—è).
   - –õ—ë–≥–∫–∏–µ –ª–∏–Ω–µ–π–Ω—ã–µ –ø—Ä–æ–µ–∫—Ü–∏–∏ (–æ–±—â–∏–µ –≤–µ—Å–∞): `q(p_j)`, `k(p_k)`.
   - –õ–æ–≥–∏—Ç—ã: `logit_{jk} = dot(q_j, k_k) + b` –¥–ª—è `k‚ààùí©(j)`.
   - Softmax —Å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π `œÑ` –∏ –æ–ø—Ü–∏–µ–π top‚ÄëK.
3. **–ü—Ä—è–º–æ–π –ø—Ä–æ—Ö–æ–¥ (CPU)**:
   - –í—Ö–æ–¥–Ω—ã–µ –ø–∞–∫–µ—Ç—ã (–±–∞—Ç—á) —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ —Ä—ë–±—Ä–∞–º `j‚Üík`: —ç–Ω–µ—Ä–≥–∏—è `Œ±¬∑e¬∑œÄ_{jk}`.
   - –≠–Ω–µ—Ä–≥–∏–∏ –∞–∫–∫—É–º—É–ª–∏—Ä—É—é—Ç—Å—è –≤ —É–∑–ª–∞—Ö —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ª–æ—è (–∏–ª–∏ —Å–ª–æ—è —á–µ—Ä–µ–∑ ¬´–ø—Ä—ã–∂–æ–∫¬ª).
   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å—É–º–º—ã —ç–Ω–µ—Ä–≥–∏–π, –∫–ª–∏–ø–ø–∏–Ω–≥.
4. **–ü–æ—Ç–µ—Ä—è**:
   - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: CE; —Ä–µ–≥—Ä–µ—Å—Å–∏—è/¬´—Å–ª–æ–∂–µ–Ω–∏–µ¬ª: MSE.
   - –†–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è: `-Œª¬∑H(œÄ)` –¥–ª—è –±–æ—Ä—å–±—ã —Å –∫–æ–ª–ª–∞–ø—Å–æ–º –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏.
5. **–û–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ—Ö–æ–¥ (CPU)**:
   - –ì—Ä–∞–¥–∏–µ–Ω—Ç—ã –ø–æ `logit_{jk}` —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π softmax‚Äëbackward.
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `q,k,b` (–∏, –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏, `w`).
   - –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä Adam (–≤ Accelerate –º–æ–∂–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å BLAS‚Äë–æ–ø–µ—Ä–∞—Ü–∏–∏).
6. **–¢–µ—Å—Ç—ã**: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å softmax, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏, –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã —á–∏—Å–ª–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π (finite differences –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –≥—Ä–∞—Ñ–æ–≤).

_–û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ‚âà 90 % (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è)._

---

### –§–∞–∑–∞ 2. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (SwiftUI, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º–∞—è)
1. **–†–µ–∂–∏–º—ã**: `--headless` –æ—Ç–∫–ª—é—á–∞–µ—Ç UI; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Å UI.
2. **–ì—Ä–∞—Ñ**:
   - `GraphView`: —Å–ª–æ–∏ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏; —É–∑–ª—ã ‚Äî —Ç–æ—á–∫–∏/–∫—Ä—É–∂–∫–∏; —Ä—ë–±—Ä–∞ ‚Äî –ª–∏–Ω–∏–∏.
   - –¢–æ–ª—â–∏–Ω–∞/—è—Ä–∫–æ—Å—Ç—å —Ä–µ–±—Ä–∞ ‚àù —ç–Ω–µ—Ä–≥–∏–∏ –ø–æ—Ç–æ–∫–∞; —Ü–≤–µ—Ç (–±–µ–∑ –∂—ë—Å—Ç–∫–∏—Ö –∫–æ–¥–æ–≤) ‚Äî –ø–æ –≤–µ–ª–∏—á–∏–Ω–µ.
3. **–≠–Ω–µ—Ä–≥–æ–ø–æ—Ç–æ–∫–∏**:
   - `EnergyFlowView`: –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –±–∞—Ç—á–∞; —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è.
   - –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å top‚ÄëK —Ä—ë–±—Ä–∞ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏.
4. **–ú–µ—Ç—Ä–∏–∫–∏**:
   - `MetricsView`: loss, —Ç–æ—á–Ω–æ—Å—Ç—å, —ç–Ω—Ç—Ä–æ–ø–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏, —Å—É–º–º–∞—Ä–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è, –¥–æ–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —É–∑–ª–æ–≤.
5. **–ü–∞–π–ø–ª–∞–π–Ω (—Å—Ç—Ä–æ–∫–∞ ‚Üí –∫–∞–ø—Å—é–ª—å ‚Üí —ç–Ω–µ—Ä–≥–∏–∏ ‚Üí –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è)**:
   - –î–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –Ω–∞–±–æ—Ä base-B —Ü–∏—Ñ—Ä, –ø–µ—Ä–≤—ã–µ/–ø–æ—Å–ª–µ–¥–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —ç–Ω–µ—Ä–≥–æ–≤–µ–∫—Ç–æ—Ä–∞, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ `Œîx/Œîy`.
   - –®–∞–≥–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å `LoggingHub` (–ø—Ä–æ—Ü–µ—Å—Å `ui.pipeline`), —á–∏—Å–ª–∞ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞ (–Ω–µ –º–æ–∫–∞–ø).
   - –ö–Ω–æ–ø–∫–∏ ¬´–ü–∞—É–∑–∞/–ü–ª–µ–π¬ª, ¬´–®–∞–≥¬ª, ¬´–°–±—Ä–æ—Å¬ª, ¬´–°–Ω–∞–ø—à–æ—Ç¬ª.
6. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: `os_signpost` –º–µ—Ç–∫–∏ –Ω–∞ —ç—Ç–∞–ø–∞—Ö ¬´forward/backward/step¬ª –¥–ª—è Instruments.

_–û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ‚âà 85 % (UI –ø–æ–Ω—è—Ç–µ–Ω; –≤–∞–∂–Ω–æ –Ω–µ ¬´–ø–µ—Ä–µ–∫—Ä–∞—Å–∏—Ç—å¬ª –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)._

---

### –§–∞–∑–∞ 3. –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –æ–±—É—á–µ–Ω–∏—è (–±–µ–∑ —Å–ø–∞–π–∫–æ–≤)
1. **–°–ª–µ–¥ –≤–æ—Å–ø—Ä–∏–∏–º—á–∏–≤–æ—Å—Ç–∏**:
   - `E_{jk} ‚Üê œÅ¬∑E_{jk} + (x_j‚àíxÃÑ_j)(y_k‚àí»≥_k)` (—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –≤–∑–≤–µ—à–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥–Ω–∏–µ –¥–ª—è xÃÑ,»≥).
2. **–ù–∞–≥—Ä–∞–¥–∞**:
   - –î–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏: `r = 1` –≤–µ—Ä–Ω–æ, `0` –Ω–µ–≤–µ—Ä–Ω–æ (–∏–ª–∏ `r = ‚àíloss`).
   - –î–ª—è —Ä–µ–≥—Ä–µ—Å—Å–∏–∏: `r = ‚àíMSE` –ø–æ –±–∞—Ç—á—É.
   - –í–≤–µ—Å—Ç–∏ **baseline** `b` (—Å–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ) ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `(r‚àíb)`.
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Å–æ–≤ —Ä—ë–±–µ—Ä**:
   - `Œîw_{jk} = Œ∑¬∑(r‚àíb)¬∑E_{jk}`; –Ω–æ—Ä–º–∏—Ä–æ–≤–∫–∞ –∏—Å—Ö–æ–¥—è—â–∏—Ö –≤–µ—Å–æ–≤ –∏ –∫–ª–∏–ø–ø–∏–Ω–≥.
4. **–†–æ—É—Ç–µ—Ä**:
   - –í–∞—Ä–∏–∞–Ω—Ç –ê: –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å backprop –¥–ª—è `q,k`.
   - –í–∞—Ä–∏–∞–Ω—Ç –ë: REINFORCE‚Äë–ø–æ–¥–æ–±–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ç–æ–≤ `g_{jk}`: `Œîg_{jk} = Œ∑_g¬∑(r‚àíb)¬∑(1{k –≤—ã–±—Ä–∞–Ω}‚àíœÄ_{jk})`.
5. **Homeostasis**:
   - –ü–æ—Ä–æ–≥/—É—Ç–µ—á–∫–∞ –≤ —É–∑–ª–∞—Ö: `ŒîŒ∏_j ‚àù (target_rate ‚àí measured_rate)` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–æ—Ä–æ–≥–∏).

_–û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ‚âà 80 % (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á–∞—Ö –ø—Ä–∏ –∞–∫–∫—É—Ä–∞—Ç–Ω—ã—Ö –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö)._

---

### –§–∞–∑–∞ 4. GPU (Metal): —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≥–æ—Ä—è—á–∏—Ö –ø—É—Ç–µ–π
1. **–ì—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å**: –≤—ã–Ω–µ—Å—Ç–∏ –Ω–∞ GPU:
   - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ç–æ–≤ `dot(q_j, k_k)` –¥–ª—è –≤—Å–µ—Ö –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Ä—ë–±–µ—Ä;
   - softmax –ø–æ —Ä—ë–±—Ä–∞–º —É–∑–ª–∞ (–≤–∞—Ä–∏–∞–Ω—Ç ‚Äî —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π softmax);
   - —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –∏ –µ—ë —Ä–µ–¥—É–∫—Ü–∏–∏ –ø–æ —Ü–µ–ª–µ–≤—ã–º —É–∑–ª–∞–º;
   - backprop –¥–ª—è softmax/–ª–æ–≥–∏—Ç–æ–≤.
2. **–î–∞–Ω–Ω—ã–µ**:
   - –†–∞–∑–º–µ—â–µ–Ω–∏–µ –≤ `MTLBuffer` –ø–ª–æ—Å–∫–∏–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏ (AoS‚ÜíSoA –¥–ª—è –∫—ç—à‚Äë–ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç–∏).
   - CSR‚Äë–ø–æ–¥–æ–±–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã: `row_ptr` (—É–∑–µ–ª‚Üí–¥–∏–∞–ø–∞–∑–æ–Ω —Ä—ë–±–µ—Ä), `col_idx` (—Ü–µ–ª–µ–≤—ã–µ —É–∑–ª—ã), `weights`.
3. **–Ø–¥—Ä–∞ Metal**:
   - Threadgroup‚Äë–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: —Å–æ–≤–º–µ—Å—Ç–Ω–∞—è –ø–∞–º—è—Ç—å –¥–ª—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å—É–º–º (softmax —Ä–µ–¥—É–∫—Ü–∏—è).
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –≤–µ—Ç–≤–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –≤–∞—Ä–ø–∞; —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä—ë–±—Ä–∞ –ø–æ –¥–ª–∏–Ω–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤.
4. **Stream/Events**:
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥–Ω—ã–µ –±—É—Ñ–µ—Ä—ã (compute encoders) –¥–ª—è forward/backward, –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –±–∞—Ç—á–∏.
5. **Fallback**:
   - –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: `Backend = .cpu | .gpu`; –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –¥–æ CPU, –µ—Å–ª–∏ GPU –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

_–û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ‚âà 75 % (–º–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ç—é–Ω–∏–Ω–≥–∞ –ø–∞–º—è—Ç–∏/—Ä–µ–¥—É–∫—Ü–∏–π)._

---

### –§–∞–∑–∞ 5. –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å (Swift Concurrency / GCD)
1. **CPU‚Äë—Ä–∞—Å—â–µ–ø–ª–µ–Ω–∏–µ**:
   - Parallel for –ø–æ —É–∑–ª–∞–º/—Ä—ë–±—Ä–∞–º (–≤–µ–∫—Ç–æ—Ä–∏–∑—É–µ–º—ã–µ —É—á–∞—Å—Ç–∫–∏ ‚Äî Accelerate/BNNS).
   - –ê—Ç–æ–º–∞—Ä–Ω—ã–µ —Ä–µ–¥—É–∫—Ü–∏–∏ —ç–Ω–µ—Ä–≥–∏–∏ –ø–æ —Ü–µ–ª–µ–≤—ã–º —É–∑–ª–∞–º —á–µ—Ä–µ–∑ –ø–µ—Ä‚Äë–ø–æ—Ç–æ—á–Ω—ã–µ –±—É—Ñ–µ—Ä—ã + —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ–¥—É–∫—Ü–∏—è.
2. **–°—Ç—Ä—É–∫—Ç—É—Ä—ã**:
   - `actor ParameterStore` (–ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∞–ø–¥–µ–π—Ç –≤–µ—Å–æ–≤); –∫–æ–ø–∏–∏‚Äë–Ω–∞‚Äë–∑–∞–ø–∏—Å—å –¥–ª—è –±–∞—Ç—á–µ–π.
   - `TaskGroup` –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –±–∞—Ç—á–µ–π; –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ –ø–æ —á–∏—Å–ª—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö —è–¥–µ—Ä.
3. **–ì–∏–±—Ä–∏–¥ CPU+GPU**:
   - GPU —Å—á–∏—Ç–∞–µ—Ç –ª–æ–≥–∏—Ç—ã/softmax; CPU ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è (—á–∞—Å—Ç–æ –ª–µ–≥—á–µ –Ω–∞ CPU).
4. **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫**:
   - –°–∏–≥–Ω–∞–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –ø–∞—É–∑—ã/—Å—Ç–µ–ø–æ–≤ –¥–ª—è UI.

_–û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ‚âà 85 % (—Ç–∏–ø–∏—á–Ω—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è Apple Silicon)._

---

### –§–∞–∑–∞ 6. –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—É—Ä
1. **–ó–∞–¥–∞—á–∏**:
   - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–∏–≥—Ä—É—à–µ—á–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç) –∏–ª–∏ ¬´—Å–ª–æ–∂–µ–Ω–∏–µ¬ª (—Ä–µ–≥—Ä–µ—Å—Å–∏—è) —Å –ø–æ–ø—É–ª—è—Ü–∏–æ–Ω–Ω—ã–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤—Ö–æ–¥–∞.
2. **–ö–æ–Ω—Ñ–∏–≥–∏**:
   - `baseline.yaml` (backprop‚Äëonly), `local_hebb.yaml` (–ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞), `discrete_routing.yaml` (top‚Äë1 + REINFORCE).
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –ö–∞–∂–¥—ã–µ N —à–∞–≥–æ–≤: loss, acc, —ç–Ω—Ç—Ä–æ–ø–∏—è, —Å—É–º–º–∞—Ä–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è, –¥–æ–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —É–∑–ª–æ–≤, –¥–ª–∏–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∞.
   - –°–Ω–∞–ø—à–æ—Ç—ã –≤–µ—Å–æ–≤/–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ —ç–∫—Å–ø–æ—Ä—Ç –≥—Ä–∞—Ñ–∞ –≤ `.json` –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω‚Äë–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.
4. **–†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è**:
   - –°–∏–¥ –≤ –∫–æ–Ω—Ñ–∏–≥–µ; —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —á–µ–∫–ø–æ–π–Ω—Ç–∞.

_–û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ‚âà 90 %._

---

### –§–∞–∑–∞ 7. –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
1. **Instruments**: Time Profiler, GPU Counters, System Trace; `os_signpost` –º–µ—Ç–∫–∏ –Ω–∞ forward/backward/step/UI.
2. **–ú–∏–∫—Ä–æ‚Äë–±–µ–Ω—á–º–∞—Ä–∫–∏**: latency/throughput –¥–ª—è —è–¥—Ä–∞ softmax –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º, —Ä–µ–¥—É–∫—Ü–∏–π —ç–Ω–µ—Ä–≥–∏–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤–µ—Å–æ–≤.
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
   - –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π (–ø—É–ª—ã –±—É—Ñ–µ—Ä–æ–≤).
   - –°–≤–µ–¥–µ–Ω–∏–µ –≤–µ—Ç–≤–ª–µ–Ω–∏–π –≤ —è–¥—Ä–∞—Ö Metal; –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ 128‚Äë–±–∞–π—Ç.
   - Batch‚Äë–æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞–∫–µ—Ç–æ–≤ –∑–∞ –ø—Ä–æ—Ö–æ–¥ (AMDGPU‚Äë–ø–æ–¥–æ–±–Ω—ã–π ¬´waves¬ª –∞–Ω–∞–ª–æ–≥ ‚Äî –∑–¥–µ—Å—å ¬´threadgroups¬ª).

_–û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ‚âà 80 %._

---

### –§–∞–∑–∞ 8. –î–∏—Å–∫—Ä–µ—Ç–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (top‚Äë1) + RL‚Äë—Ç–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
1. **Gumbel‚ÄëSoftmax** –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –¥–∏—Å–∫—Ä–µ—Ç–Ω–æ–º—É –≤—ã–±–æ—Ä—É.
2. **REINFORCE‚Äë—Å—Ç–∏–ª—å** –¥–ª—è –ª–æ–≥–∏—Ç–æ–≤ —Ä–æ—É—Ç–µ—Ä–∞; baseline –∏ —ç–Ω—Ç—Ä–æ–ø–∏–π–Ω—ã–π –±–æ–Ω—É—Å.
3. **–°–º–µ—à–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º**: –ø–µ—Ä–≤—ã–µ T —à–∞–≥–æ–≤ ‚Äî soft; –ø–æ—Å–ª–µ ‚Äî hard —Å —Ç—ë–ø–ª—ã–º —Å—Ç–∞—Ä—Ç–æ–º.

_–û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ‚âà 75 %._

---

### –§–∞–∑–∞ 9. –ß–∏—Å–ª–æ–≤–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ ¬´—ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–∫–æ–Ω—ã¬ª
1. **–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã**:
   - `‚àë_k œÄ_{jk} ‚â§ 1`, `0<Œ±‚â§1`.
   - –ö–ª–∏–ø–ø–∏–Ω–≥ —ç–Ω–µ—Ä–≥–∏–π –∏ –≤–µ—Å–æ–≤.
   - –ù–æ—Ä–º–∏—Ä–æ–≤–∫–∞ –∏—Å—Ö–æ–¥—è—â–∏—Ö –≤–µ—Å–æ–≤ –ø–æ—Å–ª–µ –∞–ø–¥–µ–π—Ç–æ–≤.
2. **–î–µ—Ç–µ–∫—Ç–æ—Ä—ã –∞–Ω–æ–º–∞–ª–∏–π**:
   - NaN/Inf guard; —Ä–µ–∑–∫–∏–µ —Å–∫–∞—á–∫–∏ loss/—ç–Ω–µ—Ä–≥–∏–∏.
3. **Homeostasis**:
   - –¶–µ–ª–µ–≤–∞—è –¥–æ–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —É–∑–ª–æ–≤; –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ—Ä–æ–≥–æ–≤ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è).

_–û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ‚âà 90 %._

---

### –§–∞–∑–∞ 10. –†–∞—Å—à–∏—Ä–µ–Ω–∏—è (—Ä–æ–∞–¥–º–∞–ø)
- **e‚Äëprop/eligibility traces** –¥–ª—è –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω–æ–≥–æ –∫—Ä–µ–¥–∏—Ç–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏.
- **Target‚Äëprop / Feedback alignment** –∫–∞–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –≥—Ä–∞–¥–∏–µ–Ω—Ç—É –Ω–∞ —á–∞—Å—Ç–∏ –ø—É—Ç–µ–π.
- **–°—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã** –¥–ª—è ¬´–ø–æ—á—Ç–∏‚Äë—Å–ø–∞–π–∫–æ–≤—ã—Ö¬ª –Ω–µ–ª–∏–Ω–µ–π–Ω–æ—Å—Ç–µ–π.
- **–†–µ–≤–µ—Ä—Å–∏–≤–Ω—ã–µ/—ç–Ω–µ—Ä–≥–æ—Å–æ—Ö—Ä–∞–Ω—è—é—â–∏–µ –±–ª–æ–∫–∏** (–¥–ª—è –ø–∞–º—è—Ç–∏/—Å–∏–º—É–ª—è—Ü–∏–∏), –Ω–æ –æ–±—É—á–µ–Ω–∏–µ –≤—Å—ë —Ä–∞–≤–Ω–æ —Ç—Ä–µ–±—É–µ—Ç —Å–∏–≥–Ω–∞–ª–∞ –∫—Ä–µ–¥–∏—Ç–∞.
- **MoE‚Äë–ø–æ–¥–æ–±–Ω—ã–µ ¬´—ç–∫—Å–ø–µ—Ä—Ç—ã¬ª** –≤–º–µ—Å—Ç–æ –µ–¥–∏–Ω—ã—Ö –æ–±—â–∏—Ö –≤–µ—Å–æ–≤ —Ä–æ—É—Ç–µ—Ä–∞ (–ø–µ—Ä‚Äë—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã).

_–û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: ‚âà 70‚Äì80 % (–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è)._

---

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ A. –ü—Ä–∏–º–µ—Ä API (—ç—Å–∫–∏–∑—ã)

```swift
// Core identifiers
struct NodeID: Hashable { let layer: Int; let index: Int }

// Packet = —ç–Ω–µ—Ä–≥–∏—è + –ø–æ–ª–æ–∂–µ–Ω–∏–µ
struct Packet {
    var energy: Float
    var node: NodeID
}

// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–æ—É—Ç–µ—Ä–∞ (–æ–±—â–∏–µ)
struct RouterParams {
    var Q: [Float] // [numNodes, d]
    var K: [Float] // [numNodes, d]
    var bias: [Float] // [numEdges] –∏–ª–∏ [numNodes]
    var tau: Float
    var alpha: Float
}

// –ì—Ä–∞—Ñ –≤ CSR-—Ä–∞—Å–∫–ª–∞–¥–∫–µ
struct Graph {
    var rowPtr: [Int]    // [numNodes+1]
    var colIdx: [Int]    // [numEdges] -> dst
    var w: [Float]       // [numEdges] -> –≤–µ—Å –∫–∞–Ω–∞–ª–∞ (—ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π)
    var nodePos: [SIMD2<Float>] // –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
}

// –ü—Ä—è–º–æ–π –ø—Ä–æ—Ö–æ–¥ (CPU, –º—è–≥–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è)
func forwardCPU(graph: Graph, router: RouterParams, input: [Packet]) -> (nodeEnergies: [Float], edgePi: [Float]) {
    // ... –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ logit, softmax —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ ...
}

// –û–±—É—á–µ–Ω–∏–µ: backprop –¥–ª—è router-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
func backwardCPU(/*...*/) {
    // ... —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π softmax backward, Adam ...
}

// –õ–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ (reward-modulated Hebb)
func localHebbUpdate(graph: inout Graph, x: [Float], y: [Float], E: inout [Float], reward r: Float, rho: Float, lr: Float) {
    // —Å–µ–≥–º–µ–Ω—Ç–Ω–æ: E = rho*E + (x - meanX)*(y - meanY); w += lr*(r - baseline)*E
}
```

---

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ B. –ö–æ–Ω—Ñ–∏–≥ (`router` —Å–µ–∫—Ü–∏—è `Configs/baseline.yaml`)
–ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –±–∞–∑–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `Docs/config_center_schema.md`. –ù–∏–∂–µ ‚Äî —Ñ—Ä–∞–≥–º–µ–Ω—Ç, –æ—Ç–Ω–æ—Å—è—â–∏–π—Å—è –∫ —Ä–æ—É—Ç–µ—Ä—É; –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è (logging, capsule, ui) —á–∏—Ç–∞—é—Ç—Å—è —Ç–µ–º –∂–µ `ConfigCenter`.

```yaml
router:
  layers: 10
  nodes_per_layer: 1024
  prototypes:
    count: 64
    hidden_dim: 8
  neighbors:
    local: 8
    jump: 2
  alpha: 0.9
  tau: 3.0
  top_k: 4
  energy_constraints:
    max_dx: 10
    min_dx: 1
    max_dy: 64
    energy_base: 256   # –¥–µ—Ä–∂–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å capsule.base
  optimizer:
    type: adam
    lr: 1.0e-3
    beta1: 0.9
    beta2: 0.999
    eps: 1.0e-8
  entropy_reg: 0.01
  batch_size: 32
  epochs: 5
  backend: cpu
  task: addition
  headless: false
  checkpoints:
    every_steps: 100
    keep: 5
  local_learning:
    enabled: false
    rho: 0.9
    lr: 1.0e-4
    baseline_beta: 0.95
```

---

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ C. –ö–æ–º–∞–Ω–¥—ã —Å–±–æ—Ä–∫–∏/–∑–∞–ø—É—Å–∫–∞
```bash
# –°–±–æ—Ä–∫–∞
swift build -c release

# CLI (–±–µ–∑ UI)
swift run energetic --config Configs/baseline.yaml --headless

# –° UI
swift run energetic --config Configs/baseline.yaml

# –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
sudo xcrun xctrace record --template "Time Profiler" -- swift run energetic --headless
```

---

## –†–∏—Å–∫–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏
- **–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤** ‚Üí –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π `|ùí©(j)|`, top‚ÄëK, —ç–Ω—Ç—Ä–æ–ø–∏—è, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞.
- **–ö—Ä–µ–¥–∏—Ç –≤–æ –≤—Ä–µ–º–µ–Ω–∏** ‚Üí –ø–∞—Ä–∞–º–µ—Ç—Ä `œÅ` (–¥–ª–∏–Ω–∞ –ø–∞–º—è—Ç–∏), baseline –¥–ª—è –Ω–∞–≥—Ä–∞–¥—ã, e‚Äëprop –∫–∞–∫ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥.
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–π** ‚Üí –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∫–ª–∏–ø–ø–∏–Ω–≥, –Ω–æ—Ä–º–∏—Ä–æ–≤–∫–∞.
- **GPU‚Äë—É—Å–∫–æ—Ä–µ–Ω–∏–µ** ‚Üí –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å —Ç–æ–ª—å–∫–æ ¬´–≥–æ—Ä—è—á–∏–µ¬ª —É—á–∞—Å—Ç–∫–∏, —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Backend.

_–° –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –¥–æ–ª–µ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ ‚âà 85 %: —Å–æ–±–ª—é–¥–µ–Ω–∏–µ —ç—Ç–∏—Ö –ø—É–Ω–∫—Ç–æ–≤ –¥–∞—Å—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π –∫–∞—Ä–∫–∞—Å._
